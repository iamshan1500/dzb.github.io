import React, { useState } from 'react';

const TaskManagementApp = () => {
  const [tasks, setTasks] = useState([]);
  const [newTaskTitle, setNewTaskTitle] = useState('');
  const [newTaskDescription, setNewTaskDescription] = useState('');
  const [newTaskDeadline, setNewTaskDeadline] = useState('');
  const [applications, setApplications] = useState([]);
  const [currentUser, setCurrentUser] = useState(null);
  const [isManager, setIsManager] = useState(false);

  const users = [
    { username: 'admin', role: 'manager' },
    { username: 'user1', role: 'employee' },
    { username: 'user2', role: 'employee' }
  ];

  const login = (username) => {
    const user = users.find(u => u.username === username);
    if (user) {
      setCurrentUser(user);
      setIsManager(user.role === 'manager');
    }
  };

  const logout = () => {
    setCurrentUser(null);
    setIsManager(false);
  };

  const addTask = () => {
    if (isManager && newTaskTitle && newTaskDescription && newTaskDeadline) {
      setTasks([...tasks, { id: Date.now(), title: newTaskTitle, description: newTaskDescription, deadline: newTaskDeadline, applicants: [] }]);
      setNewTaskTitle('');
      setNewTaskDescription('');
      setNewTaskDeadline('');
    }
  };

  const applyForTask = (taskId, applicantName) => {
    setApplications(applications.map(application =>
      application.taskId === taskId ? { ...application, applicants: [...application.applicants, applicantName] } : application
    ));
  };

  const approveApplication = (taskId, applicantIndex) => {
    setApplications(applications.map(application =>
      application.taskId === taskId ? { ...application, approvedApplicant: application.applicants[applicantIndex] } : application
    ));
  };

  return (
    <div style={{ padding: '20px', maxWidth: '600px', margin: 'auto' }}>
      <h1>任务管理</h1>
      
      {/* Login Section */}
      {!currentUser && (
        <div>
          <h2>登录</h2>
          <select onChange={(e) => login(e.target.value)}>
            <option value="">选择用户</option>
            {users.map(user => (
              <option key={user.username} value={user.username}>{user.username}</option>
            ))}
          </select>
        </div>
      )}

      {currentUser && (
        <>
          <div>
            <h2>欢迎, {currentUser.username}</h2>
            <button onClick={logout}>退出</button>
          </div>

          {/* Manager Section */}
          {isManager && (
            <div>
              <h2>发布新任务</h2>
              <input 
                type="text" 
                placeholder="任务标题" 
                value={newTaskTitle} 
                onChange={(e) => setNewTaskTitle(e.target.value)} 
                style={{ marginRight: '10px' }}
              />
              <textarea 
                placeholder="任务描述" 
                value={newTaskDescription} 
                onChange={(e) => setNewTaskDescription(e.target.value)}
                style={{ width: '100%', marginBottom: '10px' }}
              />
              <input 
                type="date" 
                value={newTaskDeadline} 
                onChange={(e) => setNewTaskDeadline(e.target.value)}
                style={{ marginBottom: '10px' }}
              />
              <button onClick={addTask}>发布任务</button>
            </div>
          )}

          {/* Tasks List */}
          <div>
            <h2>任务列表</h2>
            {tasks.map(task => (
              <div key={task.id} style={{ border: '1px solid #ccc', padding: '10px', marginBottom: '10px' }}>
                <h3>{task.title}</h3>
                <p>{task.description}</p>
                <p><strong>截止日期:</strong> {task.deadline}</p>
                <div>
                  <h4>申请者</h4>
                  {applications.find(app => app.taskId === task.id)?.applicants?.map((applicant, index) => (
                    <div key={index}>
                      {applicant}
                      {!applications.find(app => app.taskId === task.id)?.approvedApplicant && isManager && (
                        <button onClick={() => approveApplication(task.id, index)}>批准</button>
                      )}
                    </div>
                  ))}
                </div>
                {!isManager && (
                  <div>
                    <button onClick={() => applyForTask(task.id, currentUser.username)}>申请</button>
                  </div>
                )}
              </div>
            ))}
          </div>
        </>
      )}
    </div>
  );
};

export default TaskManagementApp;



